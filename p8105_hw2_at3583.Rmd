---
title: "p8105_hw2_at3583"
author: "Alexandria D.Taylor,"
date: "September 28, 2025"
output: github_document
---

# Problem 1 -- FiveThirtyEight

```{r}
library(readr)
library(tidyverse)

# Import .csv files for FiveThirtyEight datasets
pols_df <- read_csv("~/Desktop/GIT Items/fivethirtyeight_datasets/pols-month.csv")
unemp_df <- read_csv("~/Desktop/GIT Items/fivethirtyeight_datasets/unemployment.csv")
snp_df <- read_csv("~/Desktop/GIT Items/fivethirtyeight_datasets/snp.csv")
```

```{r}
library(tidyverse)
library(dplyr)
library(tidyr)

#clean pols_df using separate
pols_df <- pols_df %>%
separate(mon, into = c("year", "month", "day"), sep ="-") %>%
mutate(across(c(year, month, day), as.integer)) %>%
mutate(
month = month.name[month],
president = ifelse(prez_gop == 1, "gop", "dem")
) %>%
select(-prez_dem, -prez_gop, -day)

#clean snp_df using separate
snp_df <- snp_df %>%
separate(date, into = c("month", "day", "year"), sep = "/") %>%
mutate(across(c(year, month, day), as.integer)) %>%
mutate(month = month.name[month]) %>%
select(year, month, everything(), -day) %>%
arrange(year, month)

#clean unemp_df from wide to longer format using tidy
unemp_df <- unemp_df %>%
pivot_longer(
Jan:Dec,
names_to = "month",
values_to = "unemployment"
) %>%
rename (year = Year) %>%
mutate(
  month = str_to_title(month),
  year = as.integer(year),
  month = month.name[match(str_to_title(month), month.abb)]
)
  
# merge pols, snp and unemp dataframes
merged_df <- pols_df %>%
  left_join(snp_df, by = c("year", "month")) %>%
  left_join(unemp_df, by = c("year", "month"))
```

The **pols_df** dataset contains information on national politicians by party, including `r ncol(pols_df) - 3` variables on party composition and affiliation of the sitting president, while the **snp_df** dataset contains monthly closing values of the S&P stock index, with `r nrow(snp_df)` observations. The **unemployment_df** dataset reports U.S. unemployment rates by year and month, tidied to long format with `r ncol(unemp_df)` fields. After cleaning and merging of all three data frames,the resulting datasets contains **`r nrow(merged_df)` observations** and **`r ncol(merged_df)` variables**, spanning the years **`r min(merged_df$year)` to `r max(merged_df$year)`**. Highlighted variables include `year`, `month`, the `president` indicator (with values `r paste(unique(merged_df$president), collapse = ", ")`), party composition counts such as `gov_gop`, `sen_gop`, `rep_gop`, the S&P closing index (`close`), and unemployment rates (`unemployment`).  

# Problem 2 -- Trash Wheel

```{r}
library(readxl)
library(janitor)
library(dplyr)
library(readr)

# read and clean Mr. Trash Wheel sheet
mr_trash <- read_excel("~/Desktop/GIT Items/202509 Trash Wheel Collection Data.xlsx", sheet = "Mr. Trash Wheel", skip = 1) %>%
  clean_names() %>%
  filter(!is.na(dumpster)) %>%
  mutate(
    year = as.integer(readr::parse_number(year)),
    sports_balls = as.integer(round(sports_balls, 0)),
    wheel = "Mr. Trash Wheel"
  )

# read and clean Professor Trash Wheel sheet
prof_trash <- read_excel("~/Desktop/GIT Items/202509 Trash Wheel Collection Data.xlsx", sheet = "Professor Trash Wheel", skip = 1) %>%
  clean_names() %>%
  filter(!is.na(dumpster)) %>%
  mutate(
    year = as.integer(readr::parse_number(as.character(year))),
    wheel = "Professor Trash Wheel")

# read and clean Gwynns Falls Trash Wheel sheet
gwynnda <- read_excel("~/Desktop/GIT Items/202509 Trash Wheel Collection Data.xlsx", sheet = "Gwynns Falls Trash Wheel", skip = 1) %>%
  clean_names() %>%
  filter(!is.na(dumpster)) %>%
  mutate(
    year = as.integer(readr::parse_number(as.character(year))),
    wheel = "Gwynnda")
```

```{r check structure,include=FALSE}
# check data structure before binding
str(mr_trash$year)
str(prof_trash$year)
str(gwynnda$year)
```

```{r}
# combine dataframes into one tidy dataset
trash_df <- bind_rows(mr_trash, prof_trash, gwynnda)
```

 The combined Trash Wheel dataset contains `r nrow(trash_df)` observations and `r ncol(trash_df)` variables, collected across `r min(trash_df$year, na.rm = TRUE)` to `r max(trash_df$year, na.rm = TRUE)`. Variables include collection date (`year`, `month`), volume and weight of trash collected (`volume_cubic_yards`), (`weight_tons`), and the counts of items such as `plastic_bottles`, `glass_bottles`, and `cigarette_butts`. Overall, Professor Trash Wheel has collected a total of `r sum(trash_df$weight_tons[trash_df$wheel == "Professor Trash Wheel"], na.rm = TRUE)` tons of trash,while Gwynnda collected `r sum(trash_df$cigarette_butts[trash_df$wheel == "Gwynnda" & trash_df$month == "June" & trash_df$year == 2022], na.rm = TRUE)` cigarette butts in June 2022.
 
# Problem 3 -- Zillow

```{r}
library(readr)
library(dplyr)
library(tidyr)
library(janitor)
library(lubridate)

# import Zillow Rent Index (ZORI) dataset
zori <- read_csv("~/Desktop/GIT Items/zillow_data/Zip_zori_uc_sfrcondomfr_sm_month_NYC.csv") %>%
clean_names()

# import Zip Codes dataset
zip_bor <- read_csv("~/Desktop/GIT Items/zillow_data/Zip Codes.csv") %>%
clean_names()
```


```{r}
# clean Zillow dataset
zori <- zori %>%
  clean_names() %>%
  rename(zip = region_name)

zori_pivot <- zori %>%
  pivot_longer(
    cols = 10:ncol(.),
    names_to = "date",
    values_to = "rent_index"
  ) %>%
  
# remove "x" from data
  mutate(
    date = str_remove(date, "^x"),
    date = ymd(date),
    year = year(date),
    month = month(date, label = TRUE, abbr = FALSE)
  )
  
# clean Zip Codes dataset 
zip_bor <- zip_bor %>%
  clean_names() %>%
  rename(zip = zip_code) %>%   # step 2: consistent key for joining
  mutate(
    borough = case_when(
      county == "New York" ~ "Manhattan",
      county == "Kings"    ~ "Brooklyn",
      county == "Bronx"    ~ "Bronx",
      county == "Queens"   ~ "Queens",
      county == "Richmond" ~ "Staten Island",
      TRUE ~ county
    )
  )

# combine datasets
zillow_df <- zori_pivot %>%
  left_join(zip_bor, by = "zip", relationship = "many-to-many")
```

```{r overview, include=FALSE}
# combined data overview
n_obs <- nrow(zillow_df)
n_zip <- n_distinct(zillow_df$zip)
n_neighborhoods <- n_distinct(zillow_df$neighborhood)
missing_zips <- setdiff(zip_bor$zip, zori_pivot$zip)

# covid rental drop
covid_drop <- zillow_df %>%
  filter(month(date) == 1, year %in% c(2020, 2021)) %>%
  select(zip, borough, neighborhood, year, rent_index) %>%
  pivot_wider(names_from = year, values_from = rent_index) %>%
  mutate(drop = `2021` - `2020`) %>%
  arrange(drop) %>%
  slice(1:10)
```

The final Zillow dataset contains `r n_obs` observations across 
`r n_zip` unique ZIP codes and `r n_neighborhoods` neighborhoods in NYC.  
A numbnerof ZIP codes from the borough dataset are not present in the Zillow dataset, including `r paste(head(missing_zips, 3), collapse = ", ")`, which can be indicative of areas with limited rental activity or incomplete creporting. When comparing January 2021 to January 2020, the ten ZIP codes with the steepest declines in rental prices, shown below, are mostly concentrated in Manhattan and Brooklyn, highlight the impact of the COVID-19 pandemic on these boroughs. `r  knitr::kable(covid_drop)`